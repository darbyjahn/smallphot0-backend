<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Gallery</title>
<link rel="stylesheet" href="/styles.css">
</head>
<body>

<h1 id="title"></h1>

<div class="upload">
  <input type="file" id="files" multiple>
  <button onclick="upload()">Upload</button>
</div>

<div class="gallery" id="gallery"></div>

<div id="lightbox" onclick="closeLB()">
  <img id="lb-img">
</div>

<script src="/lightbox.js"></script>
<script>
let username = location.pathname.split("/")[2];

function upload() {
  const files = document.getElementById("files").files;
  if (!files.length) return;

  const fd = new FormData();
  for (let f of files) fd.append("files", f);

  fetch(`/api/upload/${username}`, {
    method: "POST",
    body: fd
  }).then(() => location.reload());
}

fetch("gallery.json")
  .then(r => r.json())
  .then(g => {
    document.body.style.background = g.bg_color;
    document.body.style.color = g.text_color;
    document.getElementById("title").textContent = g.title;

    g.items
      .sort((a,b)=>a.batch-b.batch||a.seq-b.seq)
      .forEach(i => {
        const el = document.createElement(i.type==="video"?"video":"img");
        el.src = "media/" + i.stored;

        if (i.type === "video") {
          el.controls = true;
          el.playsInline = true;
        }

        el.onclick = () => openLB(el.src);
        document.getElementById("gallery").appendChild(el);
      });
  });
</script>

</body>
</html>
