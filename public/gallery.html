<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gallery</title>
<link rel="stylesheet" href="/styles.css">
</head>
<body>

<button onclick="location.href='/'">‚Üê Back to All Galleries</button>
<h1 id="title"></h1>
<input type="file" id="files" multiple>
<button id="uploadBtn">Upload</button>

<div class="gallery" id="gallery"></div>

<script>
const username = location.pathname.split("/")[2];
const galleryDiv = document.getElementById("gallery");
const titleEl = document.getElementById("title");

async function loadGallery() {
  const res = await fetch("gallery.json");
  const g = await res.json();
  titleEl.textContent = g.title;
  galleryDiv.innerHTML = "";
  g.items.forEach(i=>{
    const el = document.createElement(i.type==="video"?"video":"img");
    el.src = "media/"+i.stored;
    if(i.type==="video"){el.controls=true;el.playsInline=true;}
    galleryDiv.appendChild(el);
  });
}

// Upload files
document.getElementById("uploadBtn").onclick = async () => {
  const files = document.getElementById("files").files;
  if(!files.length) return alert("Select files");

  const fd = new FormData();
  for(let f of files) fd.append("files",f);

  const res = await fetch(`/api/upload/${username}`, {method:"POST",body:fd});
  const data = await res.json();
  if(!data.success) return alert(data.error || "Upload failed");

  loadGallery(); // refresh immediately
};

loadGallery();
</script>
</body>
</html>
