<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gallery</title>
<link rel="stylesheet" href="/styles.css">
</head>
<body>

<button onclick="goBack()" class="create-btn">‚Üê Back to Main Page</button>

<h1 id="title"></h1>
<div class="upload">
  <input type="file" id="files" multiple>
  <button onclick="uploadFiles()">Upload</button>
</div>
<div class="gallery" id="gallery"></div>

<script>
let username = location.pathname.split("/")[2];
const galleryEl = document.getElementById("gallery");

function goBack(){ window.location.href="/index.html"; }

async function uploadFiles() {
  const files = document.getElementById("files").files;
  if (!files.length) return alert("Select files");
  const fd = new FormData();
  for (let f of files) fd.append("files", f);
  const res = await fetch(`/api/upload/${username}`, { method: "POST", body: fd });
  const data = await res.json();
  if(data.success) location.reload();
  else alert(data.error || "Upload failed");
}

fetch("gallery.json")
  .then(r => r.json())
  .then(g => {
    document.body.style.background = g.bg_color;
    document.body.style.color = g.text_color;
    document.getElementById("title").textContent = g.title;

    g.items
      .sort((a,b)=>a.batch-b.batch||a.seq-b.seq)
      .forEach((i)=>{
        const el = document.createElement(i.type==="video"?"video":"img");
        el.src = "media/" + i.stored;
        if(i.type==="video"){ el.controls=true; el.playsInline=true; el.autoplay=true; el.muted=true; el.loop=true; }
        galleryEl.appendChild(el);
      });
  });
</script>
</body>
</html>
