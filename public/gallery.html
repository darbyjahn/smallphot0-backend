<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gallery</title>
</head>
<body>
<h1 id="title"></h1>

<button onclick="location.href='/'">Back to Main Page</button>

<input type="file" id="files" multiple>
<button onclick="upload()">Upload</button>

<div class="gallery" id="gallery"></div>

<script>
const username = location.pathname.split("/")[2];

async function upload(){
  const files = document.getElementById("files").files;
  if(!files.length) return alert("Select files");
  const fd = new FormData();
  for(let f of files) fd.append("files",f);
  try {
    const res = await fetch(`/api/upload/${username}`, {method:"POST", body:fd});
    const data = await res.json();
    if(data.error) return alert(data.error);
    location.reload();
  } catch(err){ alert("Upload failed"); console.error(err);}
}

async function loadGallery(){
  try{
    const res = await fetch("gallery.json");
    const g = await res.json();
    document.getElementById("title").textContent=g.title;
    const gal = document.getElementById("gallery");
    gal.innerHTML="";
    g.items.forEach(i=>{
      const el = document.createElement(i.type==="video"?"video":"img");
      el.src="media/"+i.stored;
      if(i.type==="video"){el.controls=true; el.playsInline=true;}
      gal.appendChild(el);
    });
  }catch(e){ console.error(e);}
}
loadGallery();
</script>
</body>
</html>
